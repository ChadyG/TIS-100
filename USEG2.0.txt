@0
MOV 0 ACC # MAZE
JRO DOWN  # RANDOM
ADD 1 #1,0  GEN
SUB 1 #2,-1
SUB 1 #3,0
ADD 2 #4,1
SUB 2 #5,-1
NOP #6,1
ADD 2 #7,1
NOP #8,-1
SUB 1 #9,-1
NOP #10,0
SUB 1 #11,0
ADD 1 #12,1
MOV ACC DOWN #13,0

@1
## CAVE ESCAPE
# PLAYER INPUT
S:MOV UP ACC
  SUB 4
  JLZ D
  SUB 2
  JGZ U
  ADD 1
  MOV 0 RIGHT #Z
  MOV ACC RIGHT #X
  JMP S
U:MOV -1 RIGHT #Z
  JMP E
D:MOV 1 RIGHT #Z
E:MOV 0 RIGHT #X

@2
  MOV DOWN NIL
  MOV ANY ACC #Z
  SWP
  MOV LAST ACC #X
  MOV ACC DOWN #X
  SWP
  MOV ACC DOWN #Z
A:JRO DOWN
  SWP # UNDO MOVE
  NEG
  MOV ACC DOWN #X
  SWP
  NEG
  MOV ACC DOWN #Z
  JMP A

@3
  MOV DOWN, LEFT

@4
  MOV 22 DOWN
S:MOV RIGHT ACC
  ADD 50 #MAZEVARA
A:SUB 11 #MAZEVARB
  JGZ A
  ADD 11 #MAZEVARB
  MOV ACC UP
  ADD UP
  ADD RIGHT
B:SUB 13 #MAZEVARC
  JGZ B
  ADD 13 #MAZEVARC
  MOV ACC UP
  MOV UP RIGHT
  JMP S

@5
S:MOV ANY ACC  # C
  JEZ A        # A
  SUB 35       # V
  JEZ A        # E
  MOV ACC LEFT #
  MOV LAST ACC # W
  MOV ACC LEFT # A
  ADD 998      # L
  SUB 999      # L
  ADD LEFT     #
  JLZ B        # C
  MOV 1 LAST   # H
  JMP S        # E
A:MOV LAST NIL # C
B:MOV 2 LAST   # K

@6
W:MOV 1 UP #MOVING
  ADD UP #X
  MOV ACC LEFT
  SWP
  ADD UP #Z
  MOV ACC LEFT
  SWP
  JRO LEFT
  JMP A #AIR (1)
  JMP W #WALL (2)
A:MOV -7 UP
  MOV ACC RIGHT
  SWP
  MOV ACC RIGHT
  SWP

@7
# PLAYER INIT
  MOV 250 ACC
  MOV 2 UP #STARTZ
  MOV 7 UP #STARTX
S:SWP
  MOV LEFT ACC
  MOV NIL DOWN
  MOV ACC DOWN
  MOV LEFT DOWN
  SWP
  JEZ S
  MOV 0 UP
  MOV 0 UP
  SUB 1
  JMP S

@8 
  MOV UP, RIGHT

@9
  MOV LEFT ACC
Z:SUB 1
  SWP
  MOV 36 ACC
X:SUB 1
  MOV ACC UP
  MOV ACC RIGHT
  SWP
  MOV ACC UP
  MOV ACC RIGHT
  SWP
  MOV UP RIGHT
  JNZ X
  SWP     # RENDER
  JGZ Z   # SCENE

@10
# MERGE RENDER
S:MOV ANY DOWN
  MOV LAST ACC
  MOV ACC DOWN
  SUB 22
  JEZ C
  MOV LAST DOWN
  MOV -1 DOWN
  JMP S
C:MOV -1 DOWN
  MOV 0 DOWN
  MOV 10 DOWN
F:MOV 0 DOWN
  MOV 3 DOWN
  JMP F

@11
# RENDER PLAYER
MOV UP NIL
MOV ACC LEFT
SWP
MOV ACC LEFT
MOV 1 LEFT
MOV UP ACC
MOV ACC LEFT
SWP
MOV UP ACC
MOV ACC LEFT
SWP
MOV 4 LEFT
